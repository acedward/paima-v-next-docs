<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-home/components/batcher" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Batcher | Paima Engine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://acedward.github.io/paima-v-next-docs/img/paima-banner.png"><meta data-rh="true" name="twitter:image" content="https://acedward.github.io/paima-v-next-docs/img/paima-banner.png"><meta data-rh="true" property="og:url" content="https://acedward.github.io/paima-v-next-docs/home/components/batcher"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Batcher | Paima Engine"><meta data-rh="true" name="description" content="NOTE THIS IS A PREVIEW DOCUMENTATION. NYI."><meta data-rh="true" property="og:description" content="NOTE THIS IS A PREVIEW DOCUMENTATION. NYI."><link data-rh="true" rel="icon" href="/paima-v-next-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://acedward.github.io/paima-v-next-docs/home/components/batcher"><link data-rh="true" rel="alternate" href="https://acedward.github.io/paima-v-next-docs/home/components/batcher" hreflang="en"><link data-rh="true" rel="alternate" href="https://acedward.github.io/paima-v-next-docs/ja/home/components/batcher" hreflang="ja"><link data-rh="true" rel="alternate" href="https://acedward.github.io/paima-v-next-docs/home/components/batcher" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><link rel="stylesheet" href="/paima-v-next-docs/assets/css/styles.c3def801.css">
<script src="/paima-v-next-docs/assets/js/runtime~main.d703a1da.js" defer="defer"></script>
<script src="/paima-v-next-docs/assets/js/main.96fcc1fa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/paima-v-next-docs/img/favicon.ico"><div role="region" aria-label="Skip to main content"><a class="skipToContent_LRwd" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_llC7" style="background-color:#2B3831;color:#ffffff" role="banner"><div class="content_Pagn announcementBarContent_QHqT">
      <div class="custom-banner">
        <p><strong>You are looking at Paima Engine v2 docs</strong></p>
        <p>Paima Engine v2 is still under constructionðŸš§</p>
      </div>
    </div></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/paima-v-next-docs/"><div class="navbar__logo"><img src="/paima-v-next-docs/img/favicon.ico" alt="Paima logo" class="themedComponent_m_92 themedComponent--light_mRW5"><img src="/paima-v-next-docs/img/favicon.ico" alt="Paima logo" class="themedComponent_m_92 themedComponent--dark_iQ27"></div><b class="navbar__title text--truncate">Paima</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_J6rI"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/paima-v-next-docs/home/components/batcher" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/paima-v-next-docs/ja/home/components/batcher" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">Japanese</a></li></ul></div><div class="navbarSearchContainer_E3Re"><div class="navbar__search searchBarContainer_sERs" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_s8y1 searchBarLoadingRing_W2S3"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Gcnp"><div class="docsWrapper_xhHm"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_P6dF" type="button"></button><div class="docRoot_QZFe"><aside class="theme-doc-sidebar-container docSidebarContainer_z8Xi"><div class="sidebarViewport_LtND"><div class="sidebar_eBd7"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_sQgX menuWithAnnouncementBar_IFIy"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/paima-v-next-docs/">Intro</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/what-is-paima-engine">What is Paima Engine?</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/paima-v-next-docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/paima-v-next-docs/home/components/">Components</a><button aria-label="Collapse sidebar category &#x27;Components&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/sync-service">Sync Protocols &amp; Chain Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/state-machine">State Machine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/api">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/paima-l2-contract">Paima L2 Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/contracts">Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/processes">Process Orchestrator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/explorer">Paima Explorer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/paima-v-next-docs/home/components/batcher">Batcher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/database">Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/grammar">Grammar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/wallets">Wallets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/randomness">Randomness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/achievements">Achievements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/frontend">Frontend (dApp)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/accounts">Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/paima-v-next-docs/home/components/node-startup">Node Startup</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/paima-v-next-docs/home/chains/">Chains</a><button aria-label="Expand sidebar category &#x27;Chains&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/paima-v-next-docs/home/deployment/deploy-game">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/paima-v-next-docs/home/paima-standards/">Paima Standards (PRCs)</a><button aria-label="Expand sidebar category &#x27;Paima Standards (PRCs)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/paima-v-next-docs/home/paima-engine/">Architecture</a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/paima-v-next-docs/home/example-tarochi/">Game Examples</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/paima-v-next-docs/home/templates/evm-midnight">Templates</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-game-templates" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Paima Game Templates<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-engine/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Paima Engine Code<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://paimastudios.com" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Paima Studios Website<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_PnPB"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Haw5"><div class="docItemContainer_OM9T"><article><div class="tocCollapsible_o4j2 theme-doc-toc-mobile tocMobile_PSvY"><button type="button" class="clean-btn tocCollapsibleButton_GQbL">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Batcher</h1></header>
<blockquote>
<p>NOTE THIS IS A PREVIEW DOCUMENTATION. NYI.</p>
</blockquote>
<p>The Batcher is a server-side application that acts as a powerful intermediary between your users and the blockchain. Its primary purpose is to solve several major user experience challenges in Web3: gas fees, transaction speed, and cross-chain friction.</p>
<p>Instead of requiring every user to submit an on-chain transaction for every action, the Batcher allows them to simply <strong>sign a message</strong> with their wallet. The Batcher then collects these signed messages, bundles them into a single payload, and submits that payload to the <code>PaimaL2Contract</code> in a single, efficient on-chain transaction.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="why-use-a-batcher">Why Use a Batcher?<a href="#why-use-a-batcher" class="hash-link" aria-label="Direct link to Why Use a Batcher?" title="Direct link to Why Use a Batcher?">â€‹</a></h3>
<p>Integrating a Batcher offers significant advantages for your dApp:</p>
<ul>
<li><strong>Gas Abstraction</strong>: The Batcher pays the gas fees for all submitted transactions, allowing you to offer a &quot;gasless&quot; experience to your users.</li>
<li><strong>Chain Abstraction</strong>: Since users only need to sign a message, they can use a wallet from <strong>any supported chain</strong> (like Cardano or Mina) to interact with your dApp, even if it&#x27;s deployed on an EVM chain.</li>
<li><strong>Improved User Experience</strong>: Users are not constantly interrupted by wallet pop-ups to approve transactions, leading to a much smoother experience.</li>
<li><strong>Increased Throughput</strong>: Bundling many actions into a single transaction significantly increases the number of user inputs processed per block.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="how-it-works-the-batching-flow">How It Works: The Batching Flow<a href="#how-it-works-the-batching-flow" class="hash-link" aria-label="Direct link to How It Works: The Batching Flow" title="Direct link to How It Works: The Batching Flow">â€‹</a></h3>
<p>The process from user action to state change is a secure, multi-step flow where signature verification happens <strong>inside the Paima Engine</strong>, not on-chain.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="the-on-chain-batch-format-b">The On-Chain Batch Format (<code>&amp;B</code>)<a href="#the-on-chain-batch-format-b" class="hash-link" aria-label="Direct link to the-on-chain-batch-format-b" title="Direct link to the-on-chain-batch-format-b">â€‹</a></h3>
<p>When the Batcher submits a transaction, it doesn&#x27;t use a standard JSON array. Instead, it constructs a <strong>single, specially formatted string</strong> that starts with the built-in <code>&amp;B</code> prefix. This string contains multiple &quot;subunits,&quot; each representing a single user&#x27;s signed input.</p>
<p>The structure of the string payload is conceptually:
<code>&amp;B&lt;subunit1&gt;&lt;subunit2&gt;&lt;subunit3&gt;...</code></p>
<p>Each subunit contains all the information needed for the Paima Engine to verify and process an individual action:</p>
<ul>
<li>The user&#x27;s wallet address.</li>
<li>The timestamp of the signature.</li>
<li>The user&#x27;s cryptographic signature.</li>
<li>The actual game input (as a stringified JSON array, e.g., <code>&quot;[\&quot;attack\&quot;,1,42]&quot;</code>).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="engine-side-signature-verification">Engine-Side Signature Verification<a href="#engine-side-signature-verification" class="hash-link" aria-label="Direct link to Engine-Side Signature Verification" title="Direct link to Engine-Side Signature Verification">â€‹</a></h3>
<p>This is the most critical part of the Batcher&#x27;s security model. The <code>PaimaL2Contract</code> does not validate signatures; that would be incredibly gas-intensive. Instead, the Paima Engine performs this verification off-chain.</p>
<p>When the engine&#x27;s Sync Service detects a <code>PaimaGameInteraction</code> event with a payload starting with <code>&amp;B</code>, it triggers a special process:</p>
<ol>
<li><strong>Parse Batch</strong>: The engine parses the single <code>&amp;B</code> string into its individual subunits.</li>
<li><strong>Iterate and Verify</strong>: It loops through each subunit and performs the following steps:
a. <strong>Reconstruct Message</strong>: It uses the <code>userAddress</code>, <code>millisecondTimestamp</code>, and <code>conciseInput</code> from the subunit to reconstruct the exact, deterministic message that the user&#x27;s wallet was supposed to have signed.
b. <strong>Verify Signature</strong>: It then attempts to verify the provided <code>userSignature</code> against the reconstructed message. Crucially, it intelligently tries multiple signature schemes (EVM, Cardano, Mina, etc.) to determine the user&#x27;s wallet type and validate accordingly.</li>
<li><strong>Process Valid Inputs</strong>: If the signature is valid, the engine processes the <code>conciseInput</code> through the standard Grammar and State Machine. If the signature is invalid, the subunit is safely discarded, and the engine moves to the next one. This prevents a single invalid signature from halting the entire batch.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="the-default-batcher-implementation">The Default Batcher Implementation<a href="#the-default-batcher-implementation" class="hash-link" aria-label="Direct link to The Default Batcher Implementation" title="Direct link to The Default Batcher Implementation">â€‹</a></h3>
<p>Paima Engine provides a robust, ready-to-use Batcher implementation out of the box. This default implementation handles all the core logic:</p>
<ul>
<li>Running an HTTP server with a <code>/send-input</code> endpoint.</li>
<li>Verifying cryptographic signatures for multiple wallet types.</li>
<li>Storing pending inputs securely.</li>
<li>Periodically bundling inputs into a valid on-chain batch.</li>
<li>Submitting the transaction to the <code>PaimaL2Contract</code> and handling retries.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="running-the-batcher-in-development">Running the Batcher in Development<a href="#running-the-batcher-in-development" class="hash-link" aria-label="Direct link to Running the Batcher in Development" title="Direct link to Running the Batcher in Development">â€‹</a></h3>
<p>You can enable the default Batcher in your local development environment with a single flag in your orchestrator <code>start.ts</code> file.</p>
<div class="language-ts codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-ts codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> config </span><span class="token operator">=</span><span class="token plain"> Value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">OrchestratorConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  processes</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Set this flag to true to launch the default Batcher service.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">ComponentNames</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">PAIMA_BATCHER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// You must also provide the batcher configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  batcher</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    paimaL2Address</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x...&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    batcherPrivateKey</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x...&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// A dev wallet private key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chainName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;hardhat&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>The <a href="/paima-v-next-docs/home/components/processes">Process Orchestrator</a> will automatically start and configure the Batcher service for you.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="customizing-the-batcher-for-production">Customizing the Batcher for Production<a href="#customizing-the-batcher-for-production" class="hash-link" aria-label="Direct link to Customizing the Batcher for Production" title="Direct link to Customizing the Batcher for Production">â€‹</a></h3>
<p>The default Batcher allows anyone to submit inputs. For a production environment, <strong>you are responsible for deploying and customizing your own Batcher instance.</strong></p>
<p>This is a critical step, as it allows you to implement your dApp&#x27;s specific business logic and monetization strategy.</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="1-funding-the-batcher">1. Funding the Batcher<a href="#1-funding-the-batcher" class="hash-link" aria-label="Direct link to 1. Funding the Batcher" title="Direct link to 1. Funding the Batcher">â€‹</a></h4>
<p>The Batcher&#x27;s EVM wallet must be funded with the native currency of the target chain (e.g., ETH on Arbitrum) to pay for gas fees. You are responsible for keeping this wallet topped up.</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="2-implementing-custom-logic">2. Implementing Custom Logic<a href="#2-implementing-custom-logic" class="hash-link" aria-label="Direct link to 2. Implementing Custom Logic" title="Direct link to 2. Implementing Custom Logic">â€‹</a></h4>
<p>The most important reason to customize the Batcher is to add your own validation rules. Before verifying a signature and adding an input to the queue, your Batcher can (and should) query the <strong>Paima Engine&#x27;s API</strong> to check if the user is authorized to submit a &quot;free&quot; transaction.</p>
<p>This allows you to implement rules such as:</p>
<ul>
<li>Allowing 10 free moves per day for any user.</li>
<li>Granting unlimited free moves to users who own a specific NFT.</li>
<li>Allowing users who have paid a subscription fee to submit inputs.</li>
</ul>
<p><strong>Conceptual Example (in your custom batcher&#x27;s <code>/send-input</code> handler):</strong></p>
<div class="language-ts codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-ts codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handleSendInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> userInput </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Custom Logic: Query the Paima Engine API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> paimaApiUrl </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">http://paima-engine:3333/api/check-nft-ownership/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">userInput</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation">userAddress</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">fetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">paimaApiUrl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> isNftHolder </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">isNftHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// User is authorized, proceed with signature verification and add to queue.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> defaultBatcherLogic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">addUserInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">userInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// User is not authorized, reject the request.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">403</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;User is not an NFT holder.&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="frontend-integration-sending-an-input-to-the-batcher">Frontend Integration: Sending an Input to the Batcher<a href="#frontend-integration-sending-an-input-to-the-batcher" class="hash-link" aria-label="Direct link to Frontend Integration: Sending an Input to the Batcher" title="Direct link to Frontend Integration: Sending an Input to the Batcher">â€‹</a></h3>
<p>Your frontend application is responsible for creating the correctly formatted signed message and sending it to the Batcher&#x27;s <code>/send-input</code> endpoint. The <code>@paima/concise</code> and <code>@paima/wallet</code> packages provide the necessary tools for this.</p>
<p>The process involves three main steps:</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="1-construct-the-game-input">1. Construct the Game Input<a href="#1-construct-the-game-input" class="hash-link" aria-label="Direct link to 1. Construct the Game Input" title="Direct link to 1. Construct the Game Input">â€‹</a></h4>
<p>First, create the game move as a standard JavaScript array, following the rules defined in your <a href="/paima-v-next-docs/home/components/grammar">Grammar</a>.</p>
<div class="language-ts codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-ts codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// The user&#x27;s intended action, as a structured array.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> conciseInput </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;attack&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="2-create-and-sign-the-batcher-message">2. Create and Sign the Batcher Message<a href="#2-create-and-sign-the-batcher-message" class="hash-link" aria-label="Direct link to 2. Create and Sign the Batcher Message" title="Direct link to 2. Create and Sign the Batcher Message">â€‹</a></h4>
<p>This is the most critical step. The user does not sign the <code>conciseInput</code> directly. Instead, you must use the <code>createMessageForBatcher</code> helper function. This function combines the game input with other essential data (a timestamp, the user&#x27;s address, and a security namespace) into a single, deterministic string. This is the string the user&#x27;s wallet will sign.</p>
<p>It is crucial to use this specific function because the Paima Engine uses the exact same function internally to reconstruct the message for signature verification. Any deviation will result in an invalid signature.</p>
<div class="language-ts codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-ts codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> createMessageForBatcher </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@paima/concise&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> timestamp </span><span class="token operator">=</span><span class="token plain"> Date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> userAddress </span><span class="token operator">=</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// e.g., &quot;0x123...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Create the precise message string that will be signed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> messageToSign </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createMessageForBatcher</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;my-security-namespace&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// A unique string for your dApp to prevent cross-game replay attacks.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  timestamp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  userAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token constant" style="color:rgb(189, 147, 249)">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">stringify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">conciseInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// The game input must be stringified.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Use the wallet client to sign the message.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> signature </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> walletClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">signMessage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  message</span><span class="token operator">:</span><span class="token plain"> messageToSign</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="3-submit-to-the-batcher-endpoint">3. Submit to the Batcher Endpoint<a href="#3-submit-to-the-batcher-endpoint" class="hash-link" aria-label="Direct link to 3. Submit to the Batcher Endpoint" title="Direct link to 3. Submit to the Batcher Endpoint">â€‹</a></h4>
<p>Finally, send all the components to the Batcher&#x27;s <code>/send-input</code> endpoint in a POST request.</p>
<div class="language-ts codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-ts codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// The body of the POST request.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> payload </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  addressType</span><span class="token operator">:</span><span class="token plain"> AddressType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">EVM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// The type of wallet the user signed with.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  userAddress</span><span class="token operator">:</span><span class="token plain"> userAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  userSignature</span><span class="token operator">:</span><span class="token plain"> signature</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  conciseInput</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">stringify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">conciseInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  millisecondTimestamp</span><span class="token operator">:</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Send the request to your Batcher&#x27;s URL.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">fetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation constant" style="color:rgb(189, 147, 249)">ENV</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation constant" style="color:rgb(189, 147, 249)">BATCHER_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string string" style="color:rgb(255, 121, 198)">/send-input</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;POST&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  headers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;application/json&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">stringify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="security-considerations-for-production">Security Considerations for Production<a href="#security-considerations-for-production" class="hash-link" aria-label="Direct link to Security Considerations for Production" title="Direct link to Security Considerations for Production">â€‹</a></h3>
<p>When deploying a custom Batcher, you are running a critical piece of infrastructure. Securing it is paramount.</p>
<ul>
<li><strong>Batcher Wallet Security</strong>: The Batcher&#x27;s private key controls a wallet that must be funded to pay for gas. Treat this like any production hot wallet. Use a secure key management system and never expose the private key directly in your code or environment variables in an insecure manner.</li>
<li><strong>Timestamp Validity Window</strong>: To prevent <strong>replay attacks</strong> (where an attacker captures a valid signed message and resubmits it later), your Batcher should enforce a strict validity window for timestamps. It should reject any incoming request where <code>millisecondTimestamp</code> is too old (e.g., more than 30 seconds in the past) or in the future. The Paima Engine also performs a similar check, but rejecting invalid inputs early at the Batcher saves resources.</li>
<li><strong>DoS Protection and Rate Limiting</strong>: Your Batcher&#x27;s <code>/send-input</code> endpoint is publicly exposed. You must protect it from denial-of-service (DoS) attacks and spam. Implement standard web security practices like:<!-- -->
<ul>
<li><strong>Rate Limiting</strong>: Limit the number of requests a single IP address can make per minute.</li>
<li><strong>CAPTCHA</strong>: For anonymous users, you can integrate a service like Google&#x27;s reCAPTCHA.</li>
<li><strong>API Keys</strong>: If your Batcher is being used by other backend services, require an API key.</li>
</ul>
</li>
<li><strong>Input Validation</strong>: Before even checking a signature, your custom Batcher can perform basic validation on the <code>conciseInput</code> string. For example, you can check if it&#x27;s valid JSON and if its size is within a reasonable limit to reject obvious junk requests immediately.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="when-to-bypass-the-batcher">When to Bypass the Batcher<a href="#when-to-bypass-the-batcher" class="hash-link" aria-label="Direct link to When to Bypass the Batcher" title="Direct link to When to Bypass the Batcher">â€‹</a></h3>
<p>While the Batcher is the recommended approach for most user actions, there may be specific, high-stakes operations where a direct on-chain transaction is more appropriate.</p>
<p>Consider a direct <code>PaimaL2Contract</code> interaction for:</p>
<ul>
<li><strong>High-Value Actions</strong>: For actions that involve significant value (e.g., finalizing a tournament prize, claiming a rare asset), the friction of a direct wallet confirmation can be a desirable security feature.</li>
<li><strong>No Need for Abstraction</strong>: If your dApp only runs on a single, low-cost chain and your target users are already familiar with paying gas fees, a Batcher might be an unnecessary architectural component.</li>
</ul>
<p>For most dApps, a hybrid approach works best: use the Batcher for frequent, low-stakes actions (the game loop) and direct transactions for infrequent, high-stakes administrative tasks.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/100-components/108-batcher.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_uRRq" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_xDOh"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/paima-v-next-docs/home/components/explorer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Paima Explorer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/paima-v-next-docs/home/components/database"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Database</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Fe6u thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-use-a-batcher" class="table-of-contents__link toc-highlight">Why Use a Batcher?</a></li><li><a href="#how-it-works-the-batching-flow" class="table-of-contents__link toc-highlight">How It Works: The Batching Flow</a></li><li><a href="#the-on-chain-batch-format-b" class="table-of-contents__link toc-highlight">The On-Chain Batch Format (<code>&amp;B</code>)</a></li><li><a href="#engine-side-signature-verification" class="table-of-contents__link toc-highlight">Engine-Side Signature Verification</a></li><li><a href="#the-default-batcher-implementation" class="table-of-contents__link toc-highlight">The Default Batcher Implementation</a></li><li><a href="#running-the-batcher-in-development" class="table-of-contents__link toc-highlight">Running the Batcher in Development</a></li><li><a href="#customizing-the-batcher-for-production" class="table-of-contents__link toc-highlight">Customizing the Batcher for Production</a></li><li><a href="#frontend-integration-sending-an-input-to-the-batcher" class="table-of-contents__link toc-highlight">Frontend Integration: Sending an Input to the Batcher</a></li><li><a href="#security-considerations-for-production" class="table-of-contents__link toc-highlight">Security Considerations for Production</a></li><li><a href="#when-to-bypass-the-batcher" class="table-of-contents__link toc-highlight">When to Bypass the Batcher</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Paima Studios. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>